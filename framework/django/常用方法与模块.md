

## 登入与退出



```python
from django.shortcuts import render
import json 
from django.contrib.auth import login, logout
from django.shortcuts import redirect
from django.http import HttpResponse
from django.contrib.auth.models import User
from django.contrib.auth.hashers import check_password

def index(request):
    # 先判断是否登录，登录就跳转到指定页面
    if request.user.is_authenticated:
        return redirect("/c_resource/dashboard")
    else:
        return redirect("/login")
# 登录
def sign_in(request):
    if request.method == "GET":
        if request.user.is_authenticated:
            return redirect("/c_resource/dashboard")
        else:
            return render(request, 'common/sign-in.html')
    elif request.method == "POST":
        response = {'code': 200, 'data': ''}
        theUser = json.loads(request.body)
        getUserObj = User.objects.get(email = theUser['email'])
        # 验证成功就跳转到指定页面
        if check_password(theUser['password'], getUserObj.password): 
            login(request, getUserObj)
            response = {'code': 200, 'data': '登录成功！', 'username': getUserObj.username}
        # 验证不成功返回 提示
        else:
            response = {'code': 403, 'data': '身份验证失败！请再确认email和密码提交'}
        return HttpResponse(json.dumps(response))

# 登出
def setLogout(request):
    response = {'code': 200, 'data': ''}
    logout(request)
    if not request.user.is_authenticated:
        return HttpResponse(json.dumps(response))
```





